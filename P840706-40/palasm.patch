# patch for PALASM1-ARCHIVE
# 
# This file is part of PALASM1-ARCHIVE
# 
# PALASM1-ARCHIVE is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
# 
# PALASM1-ARCHIVE is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with PALASM1-ARCHIVE.  If not, see <https://www.gnu.org/licenses/>.
#
# Author: Andreas Heitmann
# Date: 2025-01-08
#
diff --strip-trailing-cr --unified orig/pal40.for new/pal40.for
--- orig/pal40.for	2025-01-08 16:20:05.046630500 +0100
+++ new/pal40.for	2025-01-08 16:20:05.153189100 +0100
@@ -1,4 +1,51 @@
-
+C
+      INTEGER FUNCTION MOD(A,B)
+      INTEGER A,B
+      MOD=A-(A/B)*B
+      RETURN
+      END
+C
+      INTEGER FUNCTION KCLOS(LUN)
+      INTEGER*1 LUN
+      LOGICAL FLAG
+      FLAG=IOCLOS (LUN)
+      KCLOS=0
+      IF (FLAG) KCLOS=1
+      RETURN
+      END
+C
+      INTEGER FUNCTION KREAD(LUN,L1,L2,FILE)
+      IMPLICIT INTEGER*1 (A-Z)
+      CHARACTER*1 FILE(20)
+      LOGICAL FLAG
+      J=21
+10    J=J-1
+      IF (J .EQ. 0) GOTO 20
+      IF (FILE(J) .NE. ' ') GOTO 20
+      FILE(J)=CHAR(0)
+      GOTO 10
+20    FLAG=IOREAD (LUN,L1,L2,FILE)
+      KREAD=0
+      IF (FLAG) KREAD=1
+      RETURN
+      END
+C
+      INTEGER FUNCTION KWRIT(LUN,L1,L2,FILE)
+      IMPLICIT INTEGER*1 (A-Z)
+      CHARACTER*1 FILE(20)
+      LOGICAL FLAG
+      J=21
+10    J=J-1
+      IF (J .EQ. 0) GOTO 20
+      IF (FILE(J) .NE. ' ') GOTO 20
+      FILE(J)=CHAR(0)
+      GOTO 10
+20    FLAG=IOWRIT (LUN,L1,L2,FILE)
+      KWRIT=0
+      IF (FLAG) KWRIT=1
+      RETURN
+      END
+C
 C$$ PAL40.FOR
 C**PALASM40**PALASM40**PALASM40**PALASM40**PALASM40**PALASM40**PALASM40*
 C
@@ -68,28 +115,36 @@
 C
 C*********************************************************
 C
+C PATCHES FOR GFORTRAN COMPILER
+C (C) 2024 ANDREAS HEITMANN
+C
+C*******************************
+C
 C     MAIN PROGRAM
 C
       IMPLICIT INTEGER*1 (A-Z)
-      INTEGER*1 CPG(9000),CLN(80)
+      CHARACTER*1 CPG(9000),CLN(80)
       INTEGER*2 LOF(350),LLN(350),LNPTR,LNMAX
       COMMON /PDS/ LNMAX,LOF,LLN
       COMMON /LINBUF/ CLN,CPG
       COMMON /LUNIT/ CONINP,CONOUT,FILINP,FILOUT,PMS,POF,PDF,ROC,RPD
 C
-      INTEGER*1 FILE1(20),FILE2(20)
+      CHARACTER*1 FILE1(20),FILE2(20)
       INTEGER IC,IL,IC1,J,K,I,I88PRO,I8PRO,OUTPIN,IONE
-      INTEGER IPROD,COUNT,IBLOW,ILL,ILERR,IIL,IINPUT,ILE,ORCNT,IMATCH
+      INTEGER*1 IINPUT
+      INTEGER IPROD,COUNT,IBLOW,ILL,ILERR,IIL,ILE,ORCNT,IMATCH
 C
-      INTEGER*1 IPAL(3),INAME(5),REST(72),PATN(80),TITLE(80),COMP(80)
-     1  ,ISYM(8,40),IBUF(8,40),IPCNT(80),DDD(64),PPP(40)
+
+      CHARACTER*1 IPAL(3),INAME(5),REST(72),PATN(80),TITLE(80),COMP(80)
+     1  ,ISYM(8,40),IBUF(8,40)
+      INTEGER*1 IPCNT(80),DDD(64),PPP(40)
       COMMON/SPEC/ IPAL,INAME,REST,PATN,TITLE,COMP
 C
       INTEGER*1 TSTVEC(350,40),ANDAR(128,32)
       INTEGER*2 PARRY(350)
       LOGICAL LSA01(350,2)
-      COMMON /TEST/ TSTVEC,LSA01,PARRY,ANDAR
-      INTEGER*1 ISAVE(128,64)
+      COMMON /CTEST/ TSTVEC,LSA01,PARRY,ANDAR
+      CHARACTER*1 ISAVE(128,64)
       COMMON /FPLOT/ ISAVE
 C
       LOGICAL LBLANK,LLEFT,LAND,LOR,LSLASH,LEQUAL,LRIGHT,LXOR,LFIRST,
@@ -102,12 +157,27 @@
       INTEGER IDESC,IFUNCT,IEND,SINGLE
       COMMON /FTEST/IFUNCT,IDESC,IEND
 C
+      INTEGER KREAD, KWRIT
+      CHARACTER, PARAMETER :: TABP = CHAR(9)
+      CHARACTER, PARAMETER :: BELP = CHAR(7)
+      CHARACTER, PARAMETER :: FFEEDP = CHAR(12)
+      CHARACTER*1 E,O,T,P,B,D,H,S,
+     1     L,N,C,Q,U,F,Y,JJ
       DATA E/'E'/,O/'O'/,T/'T'/,P/'P'/,B/'B'/,D/'D'/,H/'H'/,S/'S'/,
      1     L/'L'/,N/'N'/,C/'C'/,Q/'Q'/,U/'U'/,F/'F'/,Y/'Y'/,JJ/'J'/
+      CHARACTER*1 BB,CC,DD,EE,FF,II,NN,
+     1     OO,PP,RR,SS,TT,UU
       DATA BB/'B'/,CC/'C'/,DD/'D'/,EE/'E'/,FF/'F'/,II/'I'/,NN/'N'/,
      1     OO/'O'/,PP/'P'/,RR/'R'/,SS/'S'/,TT/'T'/,UU/'U'/,JJ/'J'/
-      DATA BEL/007/,IBLANK/' '/,IONE/1/,CHN/'N'/,CHY/'Y'/
-      DATA TAB/9/,FFEED/12/
+      CHARACTER*1 BEL,IBLANK,CHY,CHN
+      DATA BEL/BELP/,IBLANK/' '/,IONE/1/,CHN/'N'/,CHY/'Y'/
+      CHARACTER*1 FFEED,TAB
+      DATA TAB/TABP/,FFEED/FFEEDP/
+      LOGICAL LPRD
+      CHARACTER*1 IOP
+      INTEGER KCLOS
+      INTEGER*1 ITWO,IZERO
+      DATA ITWO/2/,IZERO/0/
 C
       CALL IOINIT
 C
@@ -128,14 +198,14 @@
     2 FORMAT(/,' WHAT IS THE SOURCE FILENAME (d:filename.ext) ?: '$)
       READ(CONINP,3) (FILE1(I),I=1,20)
     3 FORMAT(20A1)
-      IF(KREAD(FILINP,2,0,FILE1) .NE. 0) GO TO 130
+      IF(KREAD(FILINP,ITWO,IZERO,FILE1) .NE. 0) GO TO 130
       WRITE(CONOUT,333)
   333 FORMAT(/,' OUTPUT FILENAME -',
      1         ' PRESS <ENTER> FOR NO OUTPUT FILE ?: '$)
       READ(CONINP,3) (FILE2(I),I=1,20)
       LUN=CONOUT
       IF(FILE2(1).EQ.IBLANK) GO TO 9
-      IF(KWRIT(FILOUT,2,0,FILE2) .NE. 0) GO TO 130
+      IF(KWRIT(FILOUT,ITWO,IZERO,FILE2) .NE. 0) GO TO 130
       LUN=FILOUT
     9 RPD=FILINP
       POF=LUN
@@ -180,7 +250,7 @@
 C
       LNPTR=0
       LNMAX=0
-10    READ(RPD,5,ENDFILE=15) (CLN(IC),IC=1,80)
+10    READ(RPD,5,END=15) (CLN(IC),IC=1,80)
 5     FORMAT(80A1)
       WRITE (CONOUT,9001)
 9001  FORMAT (1X,'.'$)
@@ -419,7 +489,7 @@
       READ(ROC,120) IOP
   120 FORMAT(A1)
 C
-      IF (IOP .GT. Y) IOP=IOP-32
+      IF (IOP .GT. Y) IOP=CHAR(ICHAR(IOP)-ICHAR(' '))
       IF(POF.NE.CONOUT) WRITE(POF,125)
   125 FORMAT('1')
       IF(IOP.EQ.E) CALL ECHO
@@ -459,12 +529,14 @@
       COMMON/SPEC/ IPAL,INAME,REST,PATN,TITLE,COMP
       LOGICAL LFUSES(64,128),LORARY(2,128),LPOLAR(40),LBYPAS(40)
       COMMON /LFUSE/LFUSES,LORARY,LPOLAR,LBYPAS
-      INTEGER*1 TSTVEC(350,40),ANDAR(128,32)
+      CHARACTER*1 TSTVEC(350,40),ANDAR(128,32)
       INTEGER*2 PARRY(350)
       LOGICAL LSA01(350,2)
-      COMMON /TEST/ TSTVEC,LSA01,PARRY,ANDAR
+      COMMON /CTEST/ TSTVEC,LSA01,PARRY,ANDAR
 C
       INTEGER PT1,PT11,PT12,I,J,K,OUT,OUTTEM,TSTCNT
+      CHARACTER L,H,DASH,CROSS,ZERO,
+     1        ONE,DONT
       DATA    L/'L'/,H/'H'/,DASH/'-'/,CROSS/'X'/,ZERO/'0'/,
      1        ONE/'1'/,DONT/'D'/
 C     INITIALISE THE LAND TO LOGICAL DONT CARE 
@@ -521,10 +593,10 @@
       IF ((OUT.EQ.23).OR.(OUT.EQ.24)) K=49
 C     INITIALISING THE FAULTS COVERED BY A TEST VECTOR AS FALSE
 C     ALL THE TEST VECTORS ARE INITIALISED TO DONT CARE VALUES
-      DO 6 I=1,400
+      DO 6 I=1,350
       DO 6 J=1,40
       TSTVEC(I,J)=DONT
-      PARRY(I)=ZERO
+      PARRY(I)=0
       LTST(I)=.FALSE.
       LSA01(I,1)=.FALSE.
       LSA01(I,2)=.FALSE.
@@ -534,7 +606,7 @@
       CALL TEST1(LTST,K,OUT,PT1,PT11)
       CALL TEST2(LTST,K,OUT,PT1,PT11,PT12)
       CALL EXCLSV(PT11,PT12,PT1)
-      CALL PROUT(PT11,PT12,PT1,OUT,TITLE)
+      CALL PROUT(PT11,PT12,PT1,OUT)
       TSTCNT=TSTCNT+PT1-1
       IF (PT11 .GE. 400) WRITE (PMS,8015) 
 8015  FORMAT (' ERROR: TOO MANY TEST VECTORS FOR TSTVEC ARRAY SIZE')
@@ -548,10 +620,10 @@
       IF((OUT.EQ.3).OR.(OUT.EQ.4)) K=113
 C     INITIALISING THE FAULTS COVERED BY A TEST VECTOR AS FALSE
 C     ALL THE TEST VECTORS ARE INITIALISED TO DONT CARE VALUES
-      DO 16 I=1,400
+      DO 16 I=1,350
       DO 16 J=1,40
       TSTVEC(I,J)=DONT
-      PARRY(I)=ZERO
+      PARRY(I)=0
       LTST(I)=.FALSE.
       LSA01(I,1)=.FALSE.
       LSA01(I,2)=.FALSE.
@@ -579,7 +651,7 @@
       INTEGER*1 TSTVEC(350,40),ANDAR(128,32),XRA(32),XRB(32)
       INTEGER*2 PARRY(350)
       LOGICAL LSA01(350,2)
-      COMMON /TEST/ TSTVEC,LSA01,PARRY,ANDAR
+      COMMON /CTEST/ TSTVEC,LSA01,PARRY,ANDAR
 C
       DATA XRA /1,2,3,4,7,8,9,10,11,12,13,14,16,17,18,19,21,
      1 22,23,24,27,28,29,30,31,32,33,34,36,37,38,39/
@@ -604,8 +676,9 @@
       INTEGER*1 TSTVEC(350,40),ANDAR(128,32)
       INTEGER*2 PARRY(350)
       LOGICAL LSA01(350,2)
-      COMMON /TEST/ TSTVEC,LSA01,PARRY,ANDAR
+      COMMON /CTEST/ TSTVEC,LSA01,PARRY,ANDAR
 C
+      CHARACTER ZERO,ONE,DONT
       DATA     ZERO/'0'/,ONE/'1'/,DONT/'D'/
 C     CHECK WHETHER A PARTICULAR PRODUCT TERM IS USED OR NOT FOR  
 C     THAT PARTICULAR OUTPUT 
@@ -639,11 +712,12 @@
 C
       LOGICAL LFUSES(64,128),LORARY(2,128),LPOLAR(40),LBYPAS(40)
       COMMON /LFUSE/LFUSES,LORARY,LPOLAR,LBYPAS
-      INTEGER*1 TSTVEC(350,40),ANDAR(128,32)
+      CHARACTER*1 TSTVEC(350,40),ANDAR(128,32)
       INTEGER*2 PARRY(350)
       LOGICAL LSA01(350,2)
-      COMMON /TEST/ TSTVEC,LSA01,PARRY,ANDAR
+      COMMON /CTEST/ TSTVEC,LSA01,PARRY,ANDAR
 C
+      CHARACTER ZERO,ONE,DONT
       DATA    ZERO/'0'/,ONE/'1'/,DONT/'D'/
       L=K+15
       DO 15 I=K,L
@@ -693,11 +767,12 @@
       IMPLICIT INTEGER*1 (A-Z)
       LOGICAL  COVERF
       INTEGER I,J,PT11,L,PT12,PT1
-      INTEGER*1 TSTVEC(350,40),ANDAR(128,32)
+      CHARACTER*1 TSTVEC(350,40),ANDAR(128,32)
       INTEGER*2 PARRY(350)
       LOGICAL LSA01(350,2)
-      COMMON /TEST/ TSTVEC,LSA01,PARRY,ANDAR
+      COMMON /CTEST/ TSTVEC,LSA01,PARRY,ANDAR
 C
+      CHARACTER ZERO,ONE,DONT
       DATA    ZERO/'0'/,ONE/'1'/,DONT/'D'/
 C
       IF ((PT11+PT1) .LT. 400) GOTO 3
@@ -743,14 +818,15 @@
       IMPLICIT INTEGER*1 (A-Z)
       COMMON /LUNIT/ CONINP,CONOUT,FILINP,FILOUT,PMS,POF,PDF,ROC,RPD
       INTEGER I,J,L,PT,PT12,PT1,PT11,OUT
-      INTEGER*1 TSTVEC(350,40),ANDAR(128,32)
+      CHARACTER*1 TSTVEC(350,40),ANDAR(128,32)
       INTEGER*2 PARRY(350)
       LOGICAL LSA01(350,2)
-      COMMON /TEST/ TSTVEC,LSA01,PARRY,ANDAR
+      COMMON /CTEST/ TSTVEC,LSA01,PARRY,ANDAR
       INTEGER*1 IPAL(3),INAME(5),REST(72),PATN(80),TITLE(80),COMP(80)
       COMMON/SPEC/ IPAL,INAME,REST,PATN,TITLE,COMP
 C
-      INTEGER*1 TEMP(42)
+      CHARACTER*1 TEMP(42)
+      CHARACTER ZERO,ONE,DONT,DASH,CROSS
       DATA    ZERO/'0'/,ONE/'1'/,DONT/'D'/,DASH/'-'/,CROSS/'X'/
       DO 35 I=1,PT11
       WRITE(POF,16)OUT,PARRY(I)-1
@@ -765,7 +841,7 @@
       IF(LSA01(I,L))TEMP(L+40)=CROSS
       IF(.NOT.LSA01(I,L)) TEMP(L+40)=DASH
    18 CONTINUE
-      IF (LSA01(I,1) .NE. LSA01(I,2)) WRITE(POF,19)TEMP
+      IF (LSA01(I,1) .NEQV. LSA01(I,2)) WRITE(POF,19)TEMP
    19 FORMAT(9X,'  ',40A1,'  ',2('   ',A1))
       DO 20 J=PT12,PT1
       IF(PARRY(J).EQ.PARRY(I)) GO TO 22
@@ -799,7 +875,7 @@
 C     IF A SET OF OUTPUT IS TO BE BYPASED AND ALSO REGISTERED AT THE
 C     SAME TIME. NO FEEDBACK PATHS ARE ALLOWED FROM BYPASED OUTPUTS
       IMPLICIT INTEGER*1 (A-Z)
-      INTEGER*1 ISYM(8,40)
+      CHARACTER*1 ISYM(8,40)
       INTEGER I,J,IMATCH
       LOGICAL FLFUSE(2,2), FLFLAG,LFEED(40)
 C
@@ -868,17 +944,21 @@
      
       IMPLICIT INTEGER*1 (A-Z)
 C
-      INTEGER*1 CPG(9000),CLN(80)
+      CHARACTER*1 CPG(9000),CLN(80)
       INTEGER*2 LOF(350),LLN(350),LNPTR,LNMAX
       COMMON /PDS/ LNMAX,LOF,LLN
       COMMON /LINBUF/ CLN,CPG
       COMMON /LUNIT/ CONINP,CONOUT,FILINP,FILOUT,PMS,POF,PDF,ROC,RPD
 C
-      INTEGER*1  IPIN(40),FVECT(32),FCVECT(6)
+      CHARACTER*1  FVECT(32),FCVECT(6)
+      INTEGER*1 IPIN(40)
       INTEGER I,IMAX,IC,IL,J,V
-      LOGICAL  LPHASE(40),LPHAS1(40)    
+      LOGICAL  LPHASE(40),LPHAS1(40)
+      CHARACTER H,L,X,Z,C,DASH
       DATA     H/'H'/,L/'L'/,X/'X'/,Z/'Z'/,C/'C'/,DASH/'-'/
+      CHARACTER COMENT,BLANK,ONE,ZERO,DONT
       DATA     COMENT/';'/,BLANK/' '/,ONE/'1'/,ZERO/'0'/,DONT/'D'/
+      CHARACTER*1 CTMP
 C     GO PASSED THE COMMENT LINES
     5 IF(CPG(LOF(IL)+IC).NE.COMENT) GO TO 6
       IL=IL+1
@@ -910,10 +990,10 @@
 C
       IF(CTMP.EQ.X) FVECT(V)=DONT
       IF(CTMP.EQ.Z) FVECT(V)=Z
-      IF((CTMP.EQ.H).AND.(LPHASE(J).NE.LPHAS1(I))) FVECT(V)=ZERO
-      IF((CTMP.EQ.H).AND.(LPHASE(J).EQ.LPHAS1(I))) FVECT(V)=ONE
-      IF((CTMP.EQ.L).AND.(LPHASE(J).NE.LPHAS1(I))) FVECT(V)=ONE
-      IF((CTMP.EQ.L).AND.(LPHASE(J).EQ.LPHAS1(I))) FVECT(V)=ZERO
+      IF((CTMP.EQ.H).AND.(LPHASE(J).NEQV.LPHAS1(I))) FVECT(V)=ZERO
+      IF((CTMP.EQ.H).AND.(LPHASE(J).EQV.LPHAS1(I))) FVECT(V)=ONE
+      IF((CTMP.EQ.L).AND.(LPHASE(J).NEQV.LPHAS1(I))) FVECT(V)=ONE
+      IF((CTMP.EQ.L).AND.(LPHASE(J).EQV.LPHAS1(I))) FVECT(V)=ZERO
 10    CONTINUE
       RETURN
       END   
@@ -929,11 +1009,12 @@
       INTEGER I,J,K
       LOGICAL LFUSES(64,128),LORARY(2,128),LPOLAR(40),LBYPAS(40)
       COMMON /LFUSE/LFUSES,LORARY,LPOLAR,LBYPAS
-      INTEGER*1 TSTVEC(350,40),ANDAR(128,32)
+      CHARACTER*1 TSTVEC(350,40),ANDAR(128,32)
       INTEGER*2 PARRY(350)
       LOGICAL LSA01(350,2)
-      COMMON /TEST/ TSTVEC,LSA01,PARRY,ANDAR
+      COMMON /CTEST/ TSTVEC,LSA01,PARRY,ANDAR
 C
+      CHARACTER ONE,ZERO
       DATA    ONE/'1'/, ZERO/'0'/
       DO 10 J=1,128
       K=1
@@ -972,14 +1053,15 @@
       INTEGER I,J
       LOGICAL FPOLAR(16)
       INTEGER*1 MAP(32)
-      INTEGER*1 TSTVEC(350,40),ANDAR(128,32)
+      CHARACTER*1 TSTVEC(350,40),ANDAR(128,32)
       INTEGER*2 PARRY(350)
       LOGICAL LSA01(350,2)
-      COMMON /TEST/ TSTVEC,LSA01,PARRY,ANDAR
+      COMMON /CTEST/ TSTVEC,LSA01,PARRY,ANDAR
 C
       LOGICAL LFUSES(64,128),LORARY(2,128),LPOLAR(40),LBYPAS(40)
       COMMON /LFUSE/LFUSES,LORARY,LPOLAR,LBYPAS
-      LOGICAL LVECT(32)          
+      CHARACTER*1 LVECT(32)
+      CHARACTER DONT
       DATA  DONT/'D'/
       DATA MAP /1,20,2,19,3,18,4,17,24,5,23,6,22,7,21,8,28,9,27,
      1 10,26,11,25,12,13,32,14,31,15,30,16,29/
@@ -1014,7 +1096,7 @@
 C      AND GENERATES TEST VECTORS
       IMPLICIT INTEGER*1 (A-Z)
 C
-      INTEGER*1 CPG(9000),CLN(80)
+      CHARACTER*1 CPG(9000),CLN(80)
       INTEGER*2 LOF(350),LLN(350),LNPTR,LNMAX
       COMMON /PDS/ LNMAX,LOF,LLN
       COMMON /LINBUF/ CLN,CPG
@@ -1022,10 +1104,13 @@
       INTEGER*1 IPAL(3),INAME(5),REST(72),PATN(80),TITLE(80),COMP(80)
       COMMON/SPEC/ IPAL,INAME,REST,PATN,TITLE,COMP
 C
-      INTEGER*1 ISYM(8,40),ISYM1(8,40),IBUF(8,40),FVECT(32),FCVECT(6),
-     1      IPIN(40),FPRE(16),FINPUT(16),FOUTPT(16),OUTPUT(16),
-     3      IPIN1(40),PREOUT(16)
-      INTEGER I,J,K,IMAX,NVECT,NTEST,IC,IC1,ERROR
+      CHARACTER*1 ISYM(8,40),ISYM1(8,40),IBUF(8,40),FVECT(32),FCVECT(6),
+     2       FPRE(16)
+      CHARACTER*1 FINPUT(16),FOUTPT(16),OUTPUT(16),
+     1      PREOUT(16)
+      INTEGER*1 IPIN(40),IPIN1(40)
+      INTEGER*1 NVECT
+      INTEGER I,J,K,IMAX,NTEST,IC,IC1,ERROR
       LOGICAL LBLANK,LLEFT,LAND,LOR,LSLASH,LEQUAL,LRIGHT,LXOR,LSAME,
      1    XORFND,LERR,LPHASE(40),LPHAS1(40),FLAG1,FLAG2,FLFUSE(2,2),
      3    LTEST(16),LMATCH
@@ -1035,13 +1120,20 @@
       INTEGER*1 TSTVEC(350,40),ANDAR(128,32)
       INTEGER*2 PARRY(350)
       LOGICAL LSA01(350,2)
-      COMMON /TEST/ TSTVEC,LSA01,PARRY,ANDAR
+      COMMON /CTEST/ TSTVEC,LSA01,PARRY,ANDAR
 C
       LOGICAL LFUSES(64,128),LORARY(2,128),LPOLAR(40),LBYPAS(40)
       COMMON /LFUSE/LFUSES,LORARY,LPOLAR,LBYPAS
+      CHARACTER*1 IDASH,L,H,X,C,Z,N0,
+     1     N1,ERR,IBLANK,COMENT,DONT
       DATA IDASH/'-'/,L/'L'/,H/'H'/,X/'X'/,C/'C'/,Z/'Z'/,N0/'0'/,
      1     N1/'1'/,ERR/'?'/,IBLANK/' '/,COMENT/';'/,DONT/'D'/
-      DATA BEL/007/
+      CHARACTER*1, PARAMETER :: BELP = CHAR(7)
+      CHARACTER*1 BEL
+      DATA BEL/BELP/
+      LOGICAL FLFLAG
+      LOGICAL FPOLAR(16)
+C      
       DO 1 I=1,40
         IPIN1(I)=0
    1  CONTINUE          
@@ -1121,7 +1213,7 @@
       IL=IL+1
       IC=0
       CALL DEVIDE(FVECT,FINPUT,FOUTPT)
-      CALL CREOUT(FINPUT,FPRE,ORARY,OUTPUT)
+      CALL CREOUT(FINPUT,FPRE,LORARY,OUTPUT)
       CALL CPOUT(OUTPUT,PREOUT)       
       CALL CHKCON(FOUTPT,OUTPUT,FCVECT,FPRE,FLAG1,FLAG2)
       CALL FLUPOL(FLFUSE,FPOLAR,OUTPUT,FPRE)
@@ -1174,7 +1266,7 @@
 C
 C       THIS SUBROUTINE DEVIDES FVECTOR INTO FINPUT AND FOUTPT
 C
-        INTEGER*1 FVECT(32),FINPUT(16),FOUTPT(16)
+        CHARACTER*1 FVECT(32),FINPUT(16),FOUTPT(16)
 C
 
         DO 10 I=1,16
@@ -1224,14 +1316,15 @@
  
         IMPLICIT INTEGER*1 (A-Z)
         COMMON /LUNIT/ CONINP,CONOUT,FILINP,FILOUT,PMS,POF,PDF,ROC,RPD
-      INTEGER*1 TSTVEC(350,40),ANDAR(128,32)
+      CHARACTER*1 TSTVEC(350,40),ANDAR(128,32)
       INTEGER*2 PARRY(350)
       LOGICAL LSA01(350,2)
-      COMMON /TEST/ TSTVEC,LSA01,PARRY,ANDAR
+      COMMON /CTEST/ TSTVEC,LSA01,PARRY,ANDAR
 C
-      INTEGER*1 FINPUT(16),FPRE(16),FCOMB(32),OUTPUT(16)
+      CHARACTER*1 FINPUT(16),FPRE(16),FCOMB(32),OUTPUT(16)
       INTEGER I,J,M,INDEX,COUNT
       LOGICAL  ODD,TEST,ORARY(2,128)
+      CHARACTER H,L,D,ZERO,ONE
       DATA H/'H'/,L/'L'/,D/'D'/,ZERO/'0'/,ONE/'1'/
 C 
 C
@@ -1338,7 +1431,7 @@
 C
 C****************
 C
-        INTEGER*1 OUTPUT(16),PREOUT(16)
+        CHARACTER*1 OUTPUT(16),PREOUT(16)
         INTEGER I
         DO 1 I=1,16
           PREOUT(I)=OUTPUT(I)
@@ -1357,7 +1450,8 @@
 C********************* 
         IMPLICIT INTEGER*1 (A-Z)
         COMMON /LUNIT/ CONINP,CONOUT,FILINP,FILOUT,PMS,POF,PDF,ROC,RPD
-        INTEGER*1  OUTPUT(16),FOUTPT(16),CVECT(6),FPRE(16)
+        CHARACTER*1  OUTPUT(16),FOUTPT(16),CVECT(6),FPRE(16)
+        CHARACTER*1 Z,ZERO,ONE
         DATA Z/'Z'/,ZERO/'0'/,ONE/'1'/
         INTEGER I
         LOGICAL FLAG1,FLAG2
@@ -1404,7 +1498,7 @@
  1500   RETURN
         END
 C
-        SUBROUTINE FLUPOL(FLFUSE,FPOLAR,OUTPUT,FPRE)
+        SUBROUTINE FLUPOL(FLFUSE,LPOLAR,OUTPUT,FPRE)
 C
 C       THIS SUBROUTINE CHECKS THE BYPAS VECTOR AND LPOLAR VECTOR.
 C       IF THE OUTPUT IS BYPASED,THE CORRESPONDING FPRE WOULD BE
@@ -1415,9 +1509,10 @@
 C*********************
 C
         IMPLICIT INTEGER*1 (A-Z)
-        INTEGER*1 OUTPUT(16),FPRE(16)
+        CHARACTER*1 OUTPUT(16),FPRE(16)
         INTEGER I
         LOGICAL BYPAS(2,2),LPOLAR(16),FLFUSE(2,2)
+        CHARACTER*1 L,H,D,ZERO,ONE
         DATA L/'L'/,H/'H'/,D/'D'/,ZERO/'0'/,ONE/'1'/
 C
 C
@@ -1448,9 +1543,11 @@
 C
 C******************
         IMPLICIT INTEGER*1 (A-Z)
-        INTEGER*1 OUTPUT(16),FOUTPT(16)
+        LOGICAL FLAG1,FLAG2
+        CHARACTER*1 OUTPUT(16),FOUTPT(16)
         INTEGER I
         LOGICAL LTEST(16)
+        CHARACTER*1 D
         DATA D/'D'/
 C
         DO 1 I=1,16
@@ -1491,10 +1588,13 @@
 C
         IMPLICIT INTEGER*1 (A-Z)
         COMMON /LUNIT/ CONINP,CONOUT,FILINP,FILOUT,PMS,POF,PDF,ROC,RPD
-        INTEGER*1 IPIN1(40),FVECT(32),OUTPUT(16),FNCTBL,TEMP(40),
-     1   ACTUAL(40),EXPECT(40),NVECT,TMPBUF(9),ISYM(8,40),CVECT(6)
+        CHARACTER*1 FVECT(32),OUTPUT(16),TEMP(40),
+     1   ACTUAL(40),EXPECT(40),TMPBUF(9),ISYM(8,40),CVECT(6)
+        INTEGER*1 IPIN1(40),FNCTBL,NVECT
         INTEGER ERROR,I,N,J,K
         LOGICAL LPHASE(40),LPHAS1(40),CHECK(40),LTEST(16),TMPHAS(40)
+        CHARACTER*1 MARK,DONT,ZERO,ONE,LOW,
+     1       HIGH,X,BLANK
         DATA MARK/'?'/,DONT/'D'/,ZERO/'0'/,ONE/'1'/,LOW/'L'/,
      1       HIGH/'H'/,X/'X'/,BLANK/' '/
 C
@@ -1623,7 +1723,8 @@
 C
 C**********************
 C
-        INTEGER*1 TEMP(40),IPIN1(40),CVECT(6)
+        CHARACTER*1 TEMP(40),CVECT(6)
+        INTEGER*1 IPIN1(40)
         INTEGER FNCTBL
         LOGICAL LPHASE(40),LPHAS1(40),TMPHAS(40)
         FNCTBL=IPIN1(15)
@@ -1666,9 +1767,11 @@
 C******************
 C
         IMPLICIT INTEGER*1 (A-Z)
-        INTEGER*1 TMPBUF(9),ISYM(8,40),IPIN1(40)
+        CHARACTER*1 TMPBUF(9),ISYM(8,40)
+        INTEGER*1 IPIN1(40)
         INTEGER I,FPTR,SPTR,J
         LOGICAL LPHAS1(40),LBAR
+        CHARACTER*1 BAR,BLANK
         DATA BAR/'/'/,BLANK/' '/
         LBAR=.FALSE.
         DO 1 I=1,40
@@ -1699,10 +1802,11 @@
 C
 C*********************
         IMPLICIT INTEGER*1 (A-Z)
-        INTEGER*1 FPRE(16),OUTPUT(16),PREOUT(16)
+        CHARACTER*1 FPRE(16),OUTPUT(16),PREOUT(16)
         INTEGER I
         LOGICAL FLAG1,FLAG2
 C
+        CHARACTER*1 D,Z
         DATA D/'D'/,Z/'Z'/
 C
         IF(.NOT.FLAG1.AND.(.NOT.FLAG2)) GO TO 10
@@ -1725,16 +1829,20 @@
 C*************************************
       SUBROUTINE FZPLT(LBUF,IBUF,IPROD,ITYPE,LPROD,IOP,IBLOW)
       IMPLICIT INTEGER*1 (A-Z)
+      CHARACTER*1 IOP
       COMMON /LUNIT/ CONINP,CONOUT,FILINP,FILOUT,PMS,POF,PDF,ROC,RPD
       INTEGER*1 IPAL(3),INAME(5),REST(72),PATN(80),TITLE(80),COMP(80)
       COMMON/SPEC/ IPAL,INAME,REST,PATN,TITLE,COMP
 C
-      INTEGER*1 IBUF(8,40),IOUT(90),ISAVE(128,64),IDATA(64)
+      CHARACTER*1 IBUF(8,40),IOUT(90),ISAVE(128,64),IDATA(64)
       INTEGER IPROD,IBLOW,I,J,I88PRO,I8PRO   
       LOGICAL LBUF(40),LDUMP,LPROD(128),FLAG1,FLAG2
       LOGICAL LFUSES(64,128),LORARY(2,128),LPOLAR(40),LBYPAS(40)
       COMMON /LFUSE/LFUSES,LORARY,LPOLAR,LBYPAS
       COMMON /FPLOT/ ISAVE
+      CHARACTER IAND,IOR,ISLASH,
+     1     IDASH,X,IBLANK,P,B,
+     2     D,ZERO,ONE,FX,FIDASH
       DATA IAND/'*'/,IOR/'+'/,ISLASH/'/'/,
      1     IDASH/'-'/,X/'X'/,IBLANK/' '/,P/'P'/,B/'B'/,
      2     D/'D'/,ZERO/'0'/,ONE/'1'/,FX/'0'/,FIDASH/'O'/
@@ -1767,8 +1875,9 @@
       INTEGER*1 IPAL(3),INAME(5),REST(72),PATN(80),TITLE(80),COMP(80)
       COMMON/SPEC/ IPAL,INAME,REST,PATN,TITLE,COMP
 C
-      INTEGER*1  D(64),P(16),OR(2),F(2)
+      CHARACTER*1  D(64),P(16),OR(2),F(2)
       INTEGER  IBLOW,I88PRO,I,K,J,IPROD
+      CHARACTER DASH,CROSS,H,L
       DATA     DASH/'-'/,CROSS/'X'/,H/'H'/,L/'L'/
 C
 C     THIS SUBROUTINE DISPPALYS THE FUSEPLOT IN '-' AND 'X'
@@ -1863,8 +1972,8 @@
 C
 C     I/O UNIT ASSIGNMENTS
 C
-      CONINP=1
-      CONOUT=1
+      CONINP=5
+      CONOUT=6
       FILINP=10
       FILOUT=11
 C
@@ -1882,14 +1991,21 @@
       COMMON /PDS/ LNMAX,LOF,LLN
       COMMON /LINBUF/ CLN,CPG
 C
-      INTEGER*1 INAME(5),INFO(6),IPCNT(40)
+      CHARACTER*1 INAME(5)
+      INTEGER*1 INFO(6),IPCNT(40)
       INTEGER I,J,IC,IL,IBLOW
       LOGICAL LBLANK,LLEFT,LAND,LOR,LSLASH,LEQUAL,LRIGHT,LMATCH,LXOR
       COMMON  LBLANK,LLEFT,LAND,LOR,LSLASH,LEQUAL,LRIGHT,LXOR
       LOGICAL LFUSES(64,128),LORARY(2,128),LPOLAR(40),LBYPAS(40)
       COMMON /LFUSE/LFUSES,LORARY,LPOLAR,LBYPAS
+      INTEGER*1, PARAMETER :: I1 = ICHAR('1') 
+      INTEGER*1, PARAMETER :: I2 = ICHAR('2') 
+      INTEGER*1, PARAMETER :: I3 = ICHAR('3') 
+      INTEGER*1, PARAMETER :: I6 = ICHAR('6') 
+      INTEGER*1, PARAMETER :: IR = ICHAR('R') 
       DATA INFO
-     1    /'3','2','R','1','6',1/
+     1    /I3 ,I2 ,IR ,I1 ,I6 ,1/
+      LOGICAL FLFLAG
 C
 C     INITIALISE LPOLAR. ALL OUTPUTS ARE ASSUMED TO BE ACTIVE LOW
       DO 10 J=1,40
@@ -1920,7 +2036,7 @@
 C     PAL32R16 =  1   
       LMATCH=.TRUE.    
       DO 40 I=1,5
-   40    IF(INAME(I).NE.INFO(I)) LMATCH=.FALSE.
+   40    IF(INAME(I).NE.CHAR(INFO(I))) LMATCH=.FALSE.
          IF(LMATCH) ITYPE=INFO(6)
          IF (LMATCH) GO TO 50
       IF(ITYPE.EQ.0) RETURN
@@ -1935,16 +2051,17 @@
 C      THE FOLLOWING OPERATION SYMBOL IF ANY
       IMPLICIT INTEGER*1 (A-Z)
 C
-      INTEGER*1 CPG(9000),CLN(80)
+      CHARACTER*1 CPG(9000),CLN(80)
       INTEGER*2 LOF(350),LLN(350),LNPTR,LNMAX
       COMMON /PDS/ LNMAX,LOF,LLN
       COMMON /LINBUF/ CLN,CPG
 C
-      INTEGER*1 ISYM(8,40)
+      CHARACTER*1 ISYM(8,40)
       INTEGER I,IC,IL,J
       LOGICAL LBLANK,LLEFT,LAND,LOR,LSLASH,LEQUAL,LRIGHT,LXOR,
      1        FLFLAG,LPHASE(40)
       COMMON  LBLANK,LLEFT,LAND,LOR,LSLASH,LEQUAL,LRIGHT,LXOR
+      CHARACTER IBLANK
       DATA IBLANK/' '/
       IF( (LLEFT.OR.LAND.OR.LOR.OR.LEQUAL.OR.LRIGHT) ) 
      2  CALL INCR(IC,IL,FLFLAG)
@@ -1969,18 +2086,22 @@
 C     A BYPAS FLAG TRUE IF THE OUTPUT IS BYPASED
       IMPLICIT INTEGER*1 (A-Z)
 C
-      INTEGER*1 CPG(9000),CLN(80)
+      CHARACTER*1 CPG(9000),CLN(80)
       INTEGER*2 LOF(350),LLN(350),LNPTR,LNMAX
       COMMON /PDS/ LNMAX,LOF,LLN
       COMMON /LINBUF/ CLN,CPG
 C
       INTEGER IC,IL
-      LOGICAL LBLANK,LLEFT,LAND,LOR,LSLASH,LEQUAL,LRIGHT,LXOR,TAB,
+      LOGICAL LBLANK,LLEFT,LAND,LOR,LSLASH,LEQUAL,LRIGHT,LXOR,
      1        LXOR1,FLFLAG,LCOLON
       COMMON  LBLANK,LLEFT,LAND,LOR,LSLASH,LEQUAL,LRIGHT,LXOR
-      COMMON /LUNIT/ PMS,POF,PDF
+      COMMON /LUNIT/ CONINP,CONOUT,FILINP,FILOUT,PMS,POF,PDF,ROC,RPD
+      CHARACTER, PARAMETER :: TABP = CHAR(9)
+      CHARACTER IBLANK,ILEFT,IAND,IOR,COMENT,
+     1     ISLASH,IEQUAL,IRIGHT,ICOLON,TAB
       DATA IBLANK/' '/,ILEFT/'('/,IAND/'*'/,IOR/'+'/,COMENT/';'/,
-     1        ISLASH/'/'/,IEQUAL/'='/,IRIGHT/')'/,ICOLON/':'/,TAB/009/
+     1        ISLASH/'/'/,IEQUAL/'='/,IRIGHT/')'/,ICOLON/':'/,TAB/TABP/
+      CHARACTER*1 CTMP
 C     INITIALLY THE OUTPUT IS ASSUMED TO BE BYPASED BY SETTING FLFLAG
 C     TRUE
       FLFLAG=.TRUE.     
@@ -2030,7 +2151,7 @@
 C      AND THE PIN NAME IN THE PIN LIST OR FUNCTION TABLE PIN LIST
 C
       IMPLICIT INTEGER*1 (A-Z)
-      INTEGER*1 IBUF(8,40),ISYM(8,40)
+      CHARACTER*1 IBUF(8,40),ISYM(8,40)
       INTEGER I,J,IMATCH
       LOGICAL LMATCH
 C
@@ -2056,7 +2177,8 @@
 C      THE INPUT LINE NUMBER FOR A SPECIFIC PAL.  ADD 1 TO THE INPUT
 C      LINE NUMBER IF THE PIN IS A COMPLEMENT
       IMPLICIT INTEGER*1 (A-Z)
-      INTEGER*1 ITABLE(40),ISYM(8,40)
+      CHARACTER*1 ISYM(8,40)
+      INTEGER*1 ITABLE(40)
       INTEGER IMATCH
       LOGICAL LPHASE(40),LBUF(40)
 C
@@ -2146,16 +2268,17 @@
 C     THIS SUBROUTINE PRINTS THE PINOUT OF THE PAL
       IMPLICIT INTEGER*1 (A-Z)
 C
-      INTEGER*1 CPG(9000),CLN(80)
+      CHARACTER*1 CPG(9000),CLN(80)
       INTEGER*2 LOF(350),LLN(350),LNPTR,LNMAX
       COMMON /PDS/ LNMAX,LOF,LLN
       COMMON /LINBUF/ CLN,CPG
       COMMON /LUNIT/ CONINP,CONOUT,FILINP,FILOUT,PMS,POF,PDF,ROC,RPD
 C
-      INTEGER*1 IPAL(3),INAME(5),REST(72),PATN(80),TITLE(80),COMP(80)
+      CHARACTER*1 IPAL(3),INAME(5),REST(72),PATN(80),TITLE(80),COMP(80)
       COMMON/SPEC/ IPAL,INAME,REST,PATN,TITLE,COMP
       INTEGER I,J,II,IC,IL
-      INTEGER*1 PIN(20,40),IIN(8,2)
+      CHARACTER*1 PIN(20,40),IIN(8,2)
+      CHARACTER*1 IBLANK,ISTAR
       DATA IBLANK/' '/,ISTAR/'*'/
       DO 10 J=1,40
           DO 5 I=1,20
@@ -2235,21 +2358,28 @@
 C      COMPATIBLE WITH THE DATA I/O PROGRAMMABLE LOGIC PAK (PLDS)
 C
       IMPLICIT INTEGER*1 (A-Z)
+      LOGICAL DOIT
       LOGICAL FLFUSE(2,2)
       COMMON /LUNIT/ CONINP,CONOUT,FILINP,FILOUT,PMS,POF,PDF,ROC,RPD
 C
-      INTEGER*1 IPBUF(64), IDECIO(4)
+      CHARACTER*1 IPBUF(64), IDECIO(4)
       INTEGER NT,NFUSE,NTEST,IADR,IPT,IINP,PINOUT,I,J,J1,J2,IGH,IMP
       LOGICAL LFUSES(64,128),LORARY(2,128),LPOLAR(40),LBYPAS(40)
       COMMON /LFUSE/LFUSES,LORARY,LPOLAR,LBYPAS
       INTEGER*1 TSTVEC(350,40),ANDAR(128,32)
       INTEGER*2 PARRY(350)
       LOGICAL LSA01(350,2)
-      COMMON /TEST/ TSTVEC,LSA01,PARRY,ANDAR
+      COMMON /CTEST/ TSTVEC,LSA01,PARRY,ANDAR
       INTEGER*1 IPAL(3),INAME(5),REST(72),PATN(80),TITLE(80),COMP(80)
       COMMON/SPEC/ IPAL,INAME,REST,PATN,TITLE,COMP
 C
-      DATA ZERO/'0'/,ONE/'1'/,SOH/1/,STX/2/,ETX/3/,BEL/7/,STAR/'*'/
+      CHARACTER, PARAMETER :: SOHP = CHAR(1)
+      CHARACTER, PARAMETER :: STXP = CHAR(2)
+      CHARACTER, PARAMETER :: ETXP = CHAR(3)
+      CHARACTER, PARAMETER :: BELP = CHAR(7)
+      CHARACTER*1 ZERO,ONE,SOH,STX,ETX,BEL,STAR
+      DATA ZERO/'0'/,ONE/'1'/,SOH/SOHP/,STX/STXP/,ETX/ETXP/,BEL/BELP/,
+     1     STAR/'*'/
 C
       IADR=0
       WRITE(PDF,10) BEL,BEL,SOH,STX
@@ -2338,7 +2468,7 @@
       SUBROUTINE ENCD(IDECIO,IADDR)
 C
       IMPLICIT INTEGER*1 (A-Z)
-      INTEGER*1 ICNV(16),IDECIO(4)
+      CHARACTER*1 ICNV(16),IDECIO(4)
       INTEGER J,IADDR,IDEC(4)
       DATA ICNV/'0','1','2','3','4','5','6','7','8','9',
      1  'A','B','C','D','E','F'/
@@ -2353,10 +2483,3 @@
       END
 C
 C**************************
-$ 
-100   IDECIO(J)=ICNV(IDEC(J)+1)
-      IDECIO(1)=ICNV(IDEC(1)+1)
-      RETURN
-      END
-C
-C***********************
\ No newline at end of file
